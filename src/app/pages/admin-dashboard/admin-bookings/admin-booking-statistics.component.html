<div class="statistics-container max-w-[1400px] mx-auto p-6 space-y-8">
  <p-toast position="bottom-right"></p-toast>

  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 px-2">
    <div>
      <app-back-button routerLink="/admin/bookings" class="mb-2 block"></app-back-button>
      <app-page-header
        title="Buchungsstatistiken"
        subtitle="Auslastung und Analysen Ihrer Buchungen">
      </app-page-header>
    </div>

    <div class="flex items-center gap-3">

      <app-export-buttons
        [isLoading]="isLoading()"
        (exportPdf)="exportStatisticsAsPdf()"
        (exportHtml)="exportStatistics()"
        (refresh)="refreshData()">
      </app-export-buttons>
    </div>
  </div>

  <app-filter-bookings
    [dateFilterOptions]="dateFilterOptions"
    [dateFilterPreset]="dateFilterPreset()"
    [dateRangeStart]="dateRangeStart()"
    [dateRangeEnd]="dateRangeEnd()"
    [filteredCount]="filteredBookings().length"
    [totalCount]="bookings().length"
    [onDateFilterPresetChange]="onDateFilterPresetChange.bind(this)"
    [onClearFilter]="clearDateFilter.bind(this)"
    [onPresetChange]="handlePresetChange.bind(this)"
    [onStartDateChange]="handleStartDateChange.bind(this)"
    [onEndDateChange]="handleEndDateChange.bind(this)">
  </app-filter-bookings>

  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-20">
      <i class="pi pi-spin pi-spinner text-5xl text-[#253359]"></i>
      <p class="mt-4 text-gray-500 font-medium">Lade Statistiken...</p>
    </div>
  } @else {

    <app-booking-statistics-overview
      [totalBookings]="filteredBookings().length"
      [differentProducts]="topProducts().length"
      [topProductCount]="topProducts().length > 0 ? topProducts()[0].count : 0">
    </app-booking-statistics-overview>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 px-2">

      <app-booking-pie-chart
        [chartData]="statusChartData()"
        [chartOptions]="chartOptions"
        [statusStats]="statusStats()"
        [totalBookings]="filteredBookings().length">
      </app-booking-pie-chart>

      <app-booking-column-chart
        [chartData]="topProductsChartData()"
        [chartOptions]="chartOptions"
        [topProducts]="topProducts()">
      </app-booking-column-chart>
    </div>
  }
</div>
