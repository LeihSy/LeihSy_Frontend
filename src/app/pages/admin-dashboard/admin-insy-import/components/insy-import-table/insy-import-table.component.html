<!-- Filter und Suche -->
<p-card class="shadow-sm mb-6">
  <div class="flex flex-wrap gap-4 items-end">
    <!-- Suche -->
    <div class="flex-1 min-w-[300px]">
      <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-2">
        Suche
      </label>
      <p-iconfield iconPosition="left" class="w-full">
        <p-inputicon class="pi pi-search"></p-inputicon>
        <input
          type="text"
          pInputText
          id="searchInput"
          placeholder="Suche nach Name, Beschreibung, Inventarnummer..."
          [value]="searchQuery"
          (input)="onSearchInput($event)"
          class="w-full"
        />
      </p-iconfield>
    </div>

    <!-- Status Filter -->
    <div class="flex-1 min-w-[200px]">
      <label for="statusFilter" class="block text-sm font-medium text-gray-700 mb-2">
        Status
      </label>
      <p-select
        id="statusFilter"
        name="statusFilter"
        [options]="statusOptions"
        [(ngModel)]="statusFilterValue"
        (ngModelChange)="onStatusFilterChange($event)"
        optionLabel="label"
        optionValue="value"
        placeholder="Status waehlen"
        class="w-full"
      />
    </div>

    <!-- Bulk-Aktionen -->
    @if (pendingSelectedCount > 0) {
      <div class="flex gap-2">
        <p-button
          label="Batch-Import ({{ pendingSelectedCount }})"
          icon="pi pi-check"
          (onClick)="batchImport.emit()"
          severity="success"
          size="small"
        />
        <p-button
          label="Alle ablehnen ({{ pendingSelectedCount }})"
          icon="pi pi-times"
          (onClick)="batchReject.emit()"
          severity="danger"
          size="small"
        />
      </div>
    }
  </div>
</p-card>

<!-- Import-Requests Tabelle -->
<p-card class="shadow-sm">
  <p-table
    [value]="requests()"
    [loading]="isLoading()"
    [(selection)]="selectedRequests"
    dataKey="id"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[5, 10, 25, 50]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Zeige {first} bis {last} von {totalRecords} Eintraegen"
    class="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th scope="col" style="width: 4rem">
          <p-tableHeaderCheckbox />
        </th>
        <th scope="col" pSortableColumn="id">
          ID <p-sortIcon field="id" />
        </th>
        <th scope="col" pSortableColumn="name">
          Name <p-sortIcon field="name" />
        </th>
        <th scope="col" pSortableColumn="invNumber">
          Inv-Nr <p-sortIcon field="invNumber" />
        </th>
        <th scope="col" pSortableColumn="location">
          Standort <p-sortIcon field="location" />
        </th>
        <th scope="col">
          Matching
        </th>
        <th scope="col" pSortableColumn="status">
          Status <p-sortIcon field="status" />
        </th>
        <th scope="col" pSortableColumn="createdAt">
          Erstellt am <p-sortIcon field="createdAt" />
        </th>
        <th scope="col" style="width: 10rem">Aktionen</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-request>
      <tr [class.bg-blue-50]="isNewRequest(request)">
        <td>
          <p-tableCheckbox [value]="request" />
        </td>
        <td>
          <div class="flex items-center gap-2">
            {{ request.id }}
            @if (isNewRequest(request)) {
              <p-chip label="NEU" class="text-xs" />
            }
          </div>
        </td>
        <td>
          <div class="font-medium">{{ request.name }}</div>
          @if (request.description) {
            <div class="text-sm text-gray-500 truncate max-w-xs">
              {{ request.description }}
            </div>
          }
        </td>
        <td>
          <code class="text-sm bg-gray-100 px-2 py-1 rounded">
            {{ request.invNumber }}
          </code>
        </td>
        <td>{{ request.location || '-' }}</td>
        <td>
          @if (request.hasMatchingProduct) {
            <p-tag
              [value]="request.matchingProductName"
              severity="info"
              icon="pi pi-link"
              pTooltip="Passendes Produkt gefunden"
              tooltipPosition="top"
            />
          } @else {
            <span class="text-gray-400">Kein Match</span>
          }
        </td>
        <td>
          <p-tag
            [value]="getStatusLabel(request.status)"
            [severity]="getStatusSeverity(request.status)"
          />
        </td>
        <td>{{ formatDate(request.createdAt) }}</td>
        <td>
          <div class="flex gap-1">
            @if (request.status === 'PENDING') {
              <p-button
                icon="pi pi-check"
                [rounded]="true"
                [text]="true"
                severity="success"
                pTooltip="Importieren"
                tooltipPosition="top"
                (onClick)="importRequest.emit(request)"
              />
              <p-button
                icon="pi pi-times"
                [rounded]="true"
                [text]="true"
                severity="danger"
                pTooltip="Ablehnen"
                tooltipPosition="top"
                (onClick)="rejectRequest.emit(request)"
              />
            }
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9" class="text-center py-8">
          <div class="flex flex-col items-center gap-3">
            <i class="pi pi-inbox text-6xl text-gray-300"></i>
            <p class="text-gray-500">Keine Import-Anfragen gefunden</p>
            <p-button
              label="Mock-Daten laden"
              icon="pi pi-refresh"
              (onClick)="refresh.emit()"
              [outlined]="true"
            />
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
