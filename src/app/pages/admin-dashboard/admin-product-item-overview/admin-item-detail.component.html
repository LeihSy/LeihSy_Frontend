<div class="p-8 max-w-7xl mx-auto">
  <p-toast position="bottom-right"></p-toast>

  <app-back-button (backClick)="goBack()"></app-back-button>

  @if (pageService.isLoading()) {
    <div class="flex flex-col items-center justify-center p-16 text-center">
      <i class="pi pi-spin pi-spinner text-4xl text-[#253359]"></i>
      <p class="mt-4 text-gray-600">Lade Details...</p>
    </div>
  }

  @if (!pageService.isLoading() && pageService.item()) {
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

      <!-- Item Information -->
      <app-detail-card header="Gegenstand Details">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h2 class="text-2xl font-bold text-[#253359]">{{ pageService.item()!.invNumber }}</h2>
            <p-tag
              [value]="pageService.item()!.isAvailable ? 'Verfügbar' : 'Ausgeliehen'"
              [severity]="getStatusSeverity(pageService.item()!.isAvailable)"
              class="mt-2">
            </p-tag>
          </div>
        </div>

        <app-info-section
          header="Gegenstand Informationen"
          [items]="pageService.itemInfoItems()">
          <span tag>
            <p-tag
              [value]="pageService.item()!.isAvailable ? 'Verfügbar' : 'Ausgeliehen'"
              [severity]="getStatusSeverity(pageService.item()!.isAvailable)"
              class="font-medium px-3 py-1.5">
            </p-tag>
          </span>
        </app-info-section>

        <div class="mt-4">
          <app-secondary-button
            icon="pi pi-external-link"
            label="Zum Gegenstand"
            [routerLink]="['/admin/items', pageService.item()!.id, 'edit']"
            class="w-full">
          </app-secondary-button>
        </div>
      </app-detail-card>

      <!-- Product Information -->
      <app-detail-card header="Zugehöriges Produkt">
        @if (pageService.product()) {
          <app-info-section
            header="Produkt Informationen"
            [items]="pageService.productInfoItems()">
          </app-info-section>

          @if (pageService.product()!.description) {
            <div class="mt-4 p-4 bg-gray-50 rounded-lg">
              <h4 class="font-semibold mb-2 text-gray-700">Beschreibung</h4>
              <p class="text-gray-600">{{ pageService.product()!.description }}</p>
            </div>
          }

          <div class="mt-4">
            <app-secondary-button
              icon="pi pi-external-link"
              label="Zum Produkt"
              [routerLink]="['/admin/products', pageService.product()!.id, 'edit']"
              class="w-full">
            </app-secondary-button>
          </div>
        } @else {
          <p class="text-gray-600">Produktinformationen werden geladen...</p>
        }
      </app-detail-card>

      <!-- Loan History (Full Width) -->
      <div class="lg:col-span-2">
        <app-loan-history
          header="Ausleihverlauf"
          [loanHistory]="pageService.loanHistory()"
          [columns]="loanHistoryColumns"
          [rows]="10"
          emptyStateMessage="Noch keine Ausleihvorgänge für diesen Gegenstand.">
        </app-loan-history>
      </div>

    </div>
  }
</div>

