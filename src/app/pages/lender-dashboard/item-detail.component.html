<div class="p-8 max-w-6xl mx-auto">

  <p-toast></p-toast>

  <!-- Back Button -->
  <button pButton icon="pi pi-arrow-left" label="Zurück zur Übersicht"
          class="p-button-text mb-4" (click)="goBack()"></button>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="text-center py-8">
      <i class="pi pi-spin pi-spinner text-4xl text-[#000080]"></i>
      <p class="mt-4 text-gray-600">Lade Item-Details...</p>
    </div>
  }

  <!-- Item Details -->
  @if (!isLoading() && item()) {
    <div class="space-y-6">

      <!-- Header Card -->
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <h1 class="text-3xl font-bold text-[#000080] mb-2">
              {{ item()!.invNumber }}
            </h1>
            <p class="text-lg text-gray-600 mb-4">{{ item()!.productName }}</p>
            <div class="flex items-center gap-3">
              <p-tag
                [value]="getStatusLabel(item()!.available)"
                [severity]="getStatusSeverity(item()!.available)"
                styleClass="text-base">
              </p-tag>
            </div>
          </div>
        </div>
      </div>

      <!-- Zwei-Spalten Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Linke Spalte: Item Informationen -->
        <div class="space-y-6">

          <!-- Basis Informationen -->
          <div class="bg-white border border-gray-200 rounded-lg p-6">
            <h2 class="text-xl font-semibold text-[#000080] mb-4">Item Informationen</h2>

            <div class="space-y-3">
              <div class="flex items-start">
                <span class="w-40 text-gray-600 font-medium">Inventarnummer:</span>
                <span class="flex-1 font-mono font-semibold">{{ item()!.invNumber }}</span>
              </div>

              <div class="flex items-start">
                <span class="w-40 text-gray-600 font-medium">Besitzer:</span>
                <span class="flex-1">{{ item()!.owner }}</span>
              </div>

              <div class="flex items-start">
                <span class="w-40 text-gray-600 font-medium">Status:</span>
                <span class="flex-1">
                  <p-tag
                    [value]="getStatusLabel(item()!.available)"
                    [severity]="getStatusSeverity(item()!.available)">
                  </p-tag>
                </span>
              </div>
            </div>
          </div>

          <!-- Produkt Informationen -->
          @if (product()) {
            <div class="bg-white border border-gray-200 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-[#000080] mb-4">Produktgruppe</h2>

              <div class="space-y-3">
                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Produkt:</span>
                  <span class="flex-1 font-semibold">{{ product()!.name }}</span>
                </div>

                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Beschreibung:</span>
                  <span class="flex-1">{{ product()!.description }}</span>
                </div>

                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Kategorie:</span>
                  <span class="flex-1">{{ product()!.category?.name || 'N/A' }}</span>
                </div>

                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Standort:</span>
                  <span class="flex-1">{{ product()!.location?.roomNr || 'N/A' }}</span>
                </div>

                @if (product()!.imageUrl) {
                  <div class="flex items-start">
                    <span class="w-40 text-gray-600 font-medium">Bild:</span>
                    <div class="flex-1">
                      <img [src]="product()!.imageUrl" [alt]="product()!.name"
                           class="max-w-full h-auto rounded border border-gray-300">
                    </div>
                  </div>
                }
              </div>
            </div>
          }

        </div>

        <!-- Rechte Spalte: Verleiher & Ausleihzeiträume -->
        <div class="space-y-6">

          <!-- Verleiher Informationen -->
          @if (product()) {
            <div class="bg-white border border-gray-200 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-[#000080] mb-4">Produkt-Info</h2>

              <div class="space-y-3">
                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Produkt ID:</span>
                  <span class="flex-1 font-semibold">{{ product()!.id }}</span>
                </div>

                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Preis:</span>
                  <span class="flex-1">{{ product()!.price | currency:'EUR' }}</span>
                </div>
              </div>
            </div>
          }

          <!-- Ausleihkonditionen -->
          @if (product()) {
            <div class="bg-white border border-gray-200 rounded-lg p-6">
              <h2 class="text-xl font-semibold text-[#000080] mb-4">Ausleihkonditionen</h2>

              <div class="space-y-3">
                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Max. Dauer:</span>
                  <span class="flex-1">{{ product()!.expiryDate }} Tage</span>
                </div>

                <div class="flex items-start">
                  <span class="w-40 text-gray-600 font-medium">Preis/Tag:</span>
                  <span class="flex-1 font-semibold">{{ product()!.price | currency: 'EUR' }}</span>
                </div>

                @if (product()!.accessories) {
                  <div class="flex items-start">
                    <span class="w-40 text-gray-600 font-medium">Zubehör:</span>
                    <span class="flex-1">{{ product()!.accessories }}</span>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Ausleihhistorie (TODO) -->
          <div class="bg-white border border-gray-200 rounded-lg p-6">
            <h2 class="text-xl font-semibold text-[#000080] mb-4">
              Ausleihzeiträume
            </h2>

            @if (loanHistory().length > 0) {
              <p-table [value]="loanHistory()" styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Von</th>
                    <th>Bis</th>
                    <th>Ausgeliehen an</th>
                    <th>Status</th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-loan>
                  <tr>
                    <td>{{ loan.startDate | date: 'dd.MM.yyyy' }}</td>
                    <td>{{ loan.endDate | date: 'dd.MM.yyyy' }}</td>
                    <td>{{ loan.borrowerName }}</td>
                    <td>
                      <p-tag [value]="loan.status" [severity]="loan.status === 'active' ? 'danger' : 'success'"></p-tag>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            } @else {
              <div class="text-center py-8 text-gray-500">
                <i class="pi pi-info-circle text-3xl mb-2"></i>
                <p>Noch keine Ausleihvorgänge vorhanden</p>
                <p class="text-sm mt-2">(Feature wird später hinzugefügt)</p>
              </div>
            }
          </div>

        </div>

      </div>

    </div>
  }

</div>

