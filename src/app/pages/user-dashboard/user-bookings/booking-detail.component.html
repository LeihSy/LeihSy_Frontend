<div class="p-8 max-w-6xl mx-auto">
  <p-toast position="bottom-right"></p-toast>

  <div class="flex items-center justify-between mb-4">
    <div>
      <button
        pButton
        icon="pi pi-arrow-left"
        label="Zurück zur Übersicht"
        class="p-button-text text-[#253359] hover:bg-[rgba(0,0,128,0.04)]"
        (click)="goBack()">
      </button>
    </div>

    <div class="flex gap-2">
      <app-filled-button
        icon="pi pi-file-pdf"
        label="Export PDF"
        (buttonClick)="exportToPdf()">
      </app-filled-button>

      <app-filled-button
        icon="pi pi-qrcode"
        label="QR-Codes anzeigen"
        (buttonClick)="openQrDialog()">
      </app-filled-button>
    </div>
  </div>

  @if (isLoading()) {
    <div class="text-center py-8 flex flex-col items-center justify-center">
      <i class="pi pi-spin pi-spinner text-4xl text-[#253359]"></i>
      <p class="mt-4 text-gray-600">Lade Buchungsdetails...</p>
    </div>
  }

  @if (!isLoading() && booking()) {
    <div class="mt-4 space-y-6">

      <!-- Header -->
      <app-booking-header
        [bookingId]="booking()!.id"
        [productName]="booking()!.productName"
        [itemInvNumber]="booking()!.itemInvNumber"
        [status]="booking()!.status"
        [statusLabel]="getStatusLabel(booking()!.status)"
        [statusSeverity]="getStatusSeverity(booking()!.status)">
      </app-booking-header>

      <!-- Content Grid: 2 columns on large screens -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Left column (info cards) -->
        <div class="space-y-6">

          <!-- Ausleihzeitraum Card -->
          <app-info-card
            header="Ausleihzeitraum"
            [items]="rentalPeriodItems()">
          </app-info-card>

          <!-- Verleiher Card -->
          <app-info-card
            header="Verleiher"
            [items]="lenderItems()">
          </app-info-card>

          <!-- Gegenstand Card -->
          <app-info-card
            header="Gegenstand"
            [items]="itemItems()">
          </app-info-card>

          @if (booking()!.message) {
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
              <div class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200 font-semibold text-[#253359] px-4 py-3">Nachricht</div>
              <div class="p-4">
                <div class="flex gap-4 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-md">
                  <i class="pi pi-comment text-blue-400 text-xl"></i>
                  <p class="text-blue-800 text-sm leading-relaxed m-0">{{ booking()!.message }}</p>
                </div>
              </div>
            </div>
          }

          <!-- Termine & Daten -->
          <app-info-card
            header="Termine & Daten"
            [items]="datesItems()">
          </app-info-card>

        </div>

        <!-- Right column: Timeline -->
        <div class="space-y-6">
          <app-booking-timeline
            [events]="timelineEvents()"
            [formatDateTime]="formatDate.bind(this)">
          </app-booking-timeline>
        </div>

      </div>

    </div>
  }

  <!-- Booking QR Dialog Component -->
  @if (!isLoading() && booking()) {
    <app-booking-qr
      [visible]="showQrDialog()"
      [bookingId]="booking()!.id"
      (closed)="onQrClosed()">
    </app-booking-qr>
  }

  @if (!isLoading() && !booking()) {
    <div class="text-center flex flex-col items-center justify-center py-8">
      <i class="pi pi-exclamation-triangle text-red-500 text-5xl mb-4"></i>
      <h2 class="text-xl font-bold text-gray-800 mb-2">Buchung nicht gefunden</h2>
      <p class="text-gray-600 mb-4">Die angeforderte Buchung konnte nicht geladen werden.</p>
      <button pButton label="Zurück zur Übersicht" class="p-button" (click)="goBack()"></button>
    </div>
  }


</div>
