<p-table
  [value]="data"
  [loading]="loading"
  [paginator]="paginator"
  [rows]="rows"
  [showPageLinks]="showPageLinks"
  [responsiveLayout]="responsiveLayout"
  [scrollable]="scrollable"
  [scrollHeight]="scrollHeight"
  styleClass="p-datatable-sm custom-table"
  [rowHover]="true"
>
  <ng-template pTemplate="header">
    <tr>
      <th *ngFor="let col of columns"
          [style.width]="col.width"
          [ngClass]="col.class"
          [pSortableColumn]="col.sortable ? col.field : undefined"
          scope="col">
        {{ col.header }}
        <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
      </th>
      <th *ngIf="showActions" class="actions-col" scope="col">Aktionen</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr
      [class.clickable-row]="rowClickable"
      [attr.tabindex]="rowClickable ? 0 : null"
      (click)="rowClickable ? onRowSelect(row) : null"
      (keydown.enter)="rowClickable ? onRowSelect(row) : null"
      (keydown.space)="rowClickable ? onRowSelect(row) : null">
      <td *ngFor="let col of columns; trackBy: trackByIndex" [ngClass]="col.class">
        <ng-container [ngSwitch]="col.type">

          <!-- Datum ohne Zeit -->
          <ng-container *ngSwitchCase="'date'">
            {{ formatValue(getCellValue(row, col), 'date') }}
          </ng-container>

          <!-- Datum mit Zeit -->
          <ng-container *ngSwitchCase="'datetime'">
            {{ formatValue(getCellValue(row, col), 'datetime') }}
          </ng-container>

          <!-- Status mit farbigem Badge -->
          <ng-container *ngSwitchCase="'status'">
            <span class="status-badge" [ngClass]="getStatusClass(getCellValue(row, col))">
              {{ getCellValue(row, col) || '-' }}
            </span>
          </ng-container>

          <!-- Badge (allgemein) -->
          <ng-container *ngSwitchCase="'badge'">
            <span class="badge">
              {{ getCellValue(row, col) || '-' }}
            </span>
          </ng-container>

          <!-- Nummer -->
          <ng-container *ngSwitchCase="'number'">
            {{ formatValue(getCellValue(row, col), 'number') }}
          </ng-container>

          <!-- WÃ¤hrung -->
          <ng-container *ngSwitchCase="'currency'">
            {{ formatValue(getCellValue(row, col), 'currency') }}
          </ng-container>

          <!-- Custom Template -->
          <ng-container *ngSwitchCase="'custom'">
            <ng-container *ngIf="col.template; else fallback">
              <ng-container *ngTemplateOutlet="col.template; context: { $implicit: row }"></ng-container>
            </ng-container>
            <ng-template #fallback>-</ng-template>
          </ng-container>

          <!-- Standard Text -->
          <ng-container *ngSwitchDefault>
            {{ getCellValue(row, col) ?? '-' }}
          </ng-container>
        </ng-container>
      </td>

      <!-- Aktions-Spalte -->
      <td *ngIf="showActions" class="actions-col">
        <div class="flex gap-2">
          <button *ngIf="showEditButton"
                  pButton
                  type="button"
                  [icon]="editButtonIcon"
                  class="p-button-sm p-button-warning"
                  (click)="onEdit(row)"
                  [pTooltip]="editButtonTooltip"></button>
          <button *ngIf="showDeleteButton"
                  pButton
                  type="button"
                  [icon]="deleteButtonIcon"
                  class="p-button-sm p-button-danger"
                  (click)="onRemove(row)"
                  [pTooltip]="deleteButtonTooltip"></button>
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td [attr.colspan]="columns.length + (showActions ? 1 : 0)" class="empty-message">
        {{ emptyMessage }}
      </td>
    </tr>
  </ng-template>
</p-table>
